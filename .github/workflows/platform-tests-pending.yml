name: Platform Tests (Pending)

on:
  pull_request_target:
    types: [opened, synchronize]

permissions:
  checks: write

jobs:
  mark-pending:
    if: github.repository == 'sveltejs/kit'
    runs-on: ubuntu-latest
    steps:
      - name: Create check run
        env:
          GH_TOKEN: ${{ github.token }}
          SHA: ${{ github.event.pull_request.head.sha }}
        run: |
          SUMMARY="Run the platform tests for this commit:

          \`\`\`
          gh workflow run platform-tests-all.yml -R ${{ github.repository }} -f sha=$SHA
          \`\`\`"

          gh api repos/${{ github.repository }}/check-runs \
            -f name=platform-tests \
            -f head_sha="$SHA" \
            -f status=completed \
            -f conclusion=action_required \
            -f 'output[title]=Platform tests need to be run' \
            -f "output[summary]=$SUMMARY"
